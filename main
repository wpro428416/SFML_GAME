#include <SFML/Graphics.hpp>
#include <SFML/Audio.hpp>

//#include "heatTest.h"
#include "backGround.h"
#include "gameSound.h"
#include "myPlane.h"
#include "enemy.h"
#include "Canvas.h"




sf::Texture bullet1;
sf::Texture bullet2;

sf::Texture enemy1;
sf::Texture enemy1_down1;
sf::Texture enemy1_down2;
sf::Texture enemy1_down3;
sf::Texture enemy1_down4;

sf::Texture enemy2;
sf::Texture enemy2_hit;
sf::Texture enemy2_down1;
sf::Texture enemy2_down2;
sf::Texture enemy2_down3;
sf::Texture enemy2_down4;

sf::Texture hero1;
sf::Texture hero2;
sf::Texture hero_blowup_n1;
sf::Texture hero_blowup_n2;
sf::Texture hero_blowup_n3;
sf::Texture hero_blowup_n4;

sf::Sprite storeSprite[200];// 前60放bullet1,60-120放bullet2,120-140放enemy1.140-160放enemy2,剩下再说
sf::Vector2f store_x_y[200];

int index_bullet1=0;//bullet1
int index_bullet2=60;//bullet2
int index_enemy1=120;//enemy1
int index_enemy2=140;//enemy2

sf::Vector2f hero1_size;
sf::Vector2f hero2_size;
sf::Vector2f enemy1_size;
sf::Vector2f enemy2_size;
sf::Vector2f enemy3_size;
sf::Vector2f bullet1_size;
sf::Vector2f bullet2_size;

sf::Vector2f hero2_pos;
sf::Vector2f bullet1_adjust;
sf::Vector2f bullet2_adjust;



int main(){
    sf::RenderWindow window(sf::VideoMode(400,600),"PLA");
    window.setFramerateLimit(60);

////////////初始预设////////////////////////

    bullet1.loadFromFile("bullet1.png");
    bullet2.loadFromFile("bullet2.png");

    enemy1.loadFromFile("enemy1.png");
    enemy1_down1.loadFromFile("enemy1_down1.png");
    enemy1_down2.loadFromFile("enemy1_down2.png");
    enemy1_down3.loadFromFile("enemy1_down3.png");
    enemy1_down4.loadFromFile("enemy1_down4.png");

    enemy2.loadFromFile("enemy2.png");
    enemy2_hit.loadFromFile("enemy2_hit.png");
    enemy2_down1.loadFromFile("enemy2_down1.png");
    enemy2_down2.loadFromFile("enemy2_down2.png");
    enemy2_down3.loadFromFile("enemy2_down3.png");
    enemy2_down4.loadFromFile("enemy2_down4.png");

    hero1.loadFromFile("hero1.png");
    hero2.loadFromFile("hero2.png");
    hero_blowup_n1.loadFromFile("hero_blowup_n1.png");
    hero_blowup_n2.loadFromFile("hero_blowup_n2.png");
    hero_blowup_n3.loadFromFile("hero_blowup_n3.png");
    hero_blowup_n4.loadFromFile("hero_blowup_n4.png");


    for(int i=0;i<160;i++){
        if(i<60){
            storeSprite[i].setTexture(bullet1);
        }
        else if(i<120){
            storeSprite[i].setTexture(bullet2);
        }
        else if(i<140){
            storeSprite[i].setTexture(enemy1);
        }
        else if(i<160){
            storeSprite[i].setTexture(enemy2);
        }
    }



//
    hero1_size=(sf::Vector2f)hero1.getSize();
    hero2_size=(sf::Vector2f)hero2.getSize();
    bullet1_size=(sf::Vector2f)bullet1.getSize();
    bullet2_size=(sf::Vector2f)bullet2.getSize();
    enemy1_size=(sf::Vector2f)enemy1.getSize();
    enemy2_size=(sf::Vector2f)enemy2.getSize();

    hero2_pos.x=(400-hero2_size.x)/2;
    hero2_pos.y=600-hero2_size.y;

    bullet1_adjust.x=(hero1_size.x-bullet1_size.x)/2;
    bullet1_adjust.y=-bullet1_size.y;
    bullet2_adjust.x=(enemy1_size.x-bullet2_size.x)/2;
    bullet2_adjust.y=enemy1_size.y;
//************************///////////////



    //设置背景//设置血条//设置分数
    BackGround background;

    int j=0;
    //设置音乐
    GameSound sound;
    sound.soundPlay();
    //设置我的飞机
    MyPlane hero(sound);
    //设置敌人的飞机
    int n=100;
    int i=1000;

    Canvas can(window);
    //设置主循环
    while(window.isOpen())
    {
        sf::Event event;
        while(window.pollEvent(event)){
            if(event.type==sf::Event::Closed)
                window.close();
        }


//载入界面
    if(j<60){
        window.draw(background.mainplay());
        window.draw(background.load());
        j++;
    }
    else{ //判断窗口失焦
        if(event.type==sf::Event::LostFocus){
           // sound.soundPause();
        }
        //判断窗口聚焦
        if(event.type==sf::Event::GainedFocus){
           // sound.soundPlay();
        }

        if(hero.life>0){

        hero.hero_hit_test();

        //判断左
        if(event.type==sf::Event::KeyPressed&&sf::Keyboard::isKeyPressed(sf::Keyboard::Left)){
                hero.moveLeft();
        }
        //判断右
        if(event.type==sf::Event::KeyPressed&&sf::Keyboard::isKeyPressed(sf::Keyboard::Right)){
                hero.moveRight();
        }
        //判断上
        if(event.type==sf::Event::KeyPressed&&sf::Keyboard::isKeyPressed(sf::Keyboard::Up)){
                hero.moveUp();
        }
        //判断下
        if(event.type==sf::Event::KeyPressed&&sf::Keyboard::isKeyPressed(sf::Keyboard::Down)){
                hero.moveDown();
        }
        //判断发射
        if(sf::Keyboard::isKeyPressed(sf::Keyboard::Space)){
                hero.launch();
                //sound.addSound();
        }
        //画图，显示
        window.clear();

        //画背景类
        window.draw(background.mainplay());
        window.draw(background.bloodplay());
        window.draw(background.textplay());
        //画我的飞机
        window.draw(hero.planePlay());

        //画小飞机、中等飞机
        n--;
        i--;
        if(n%50==0){
            Enemy enemy(1);
            n=100;
        }
        if(i%500==0){
            Enemy enemy(2);
            i=1000;
        }
        can.draw();

        }
        else{
            window.draw(background.over());
        }




}



        window.display();
    }
    return 0;
}
